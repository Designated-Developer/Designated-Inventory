import SwiftUI
import CodeScanner

struct ScannerAppView: View {
    @State private var isShowingScanner = false
    @State private var scannedCode: String?
    @Environment(\.colorScheme) var colorScheme

    var body: some View {
        NavigationView {
            VStack(spacing: 20) {
                if let code = scannedCode {
                    Text("Scanned Code:")
                        .font(.headline)
                    Text(code)
                        .font(.largeTitle)
                        .fontWeight(.bold)
                } else {
                    Text("No code scanned yet.")
                        .foregroundColor(.secondary)
                }

                Button(action: {
                    isShowingScanner = true
                }) {
                    Label("Scan", systemImage: "barcode.viewfinder")
                        .font(.title2)
                        .padding()
                        .background(Color.accentColor)
                        .foregroundColor(.white)
                        .cornerRadius(8)
                        .hoverEffect(.highlight)
                }

                Spacer()
            }
            .padding()
            .background(colorScheme == .dark ? Color.black : Color.white)
            .navigationBarTitle("Barcode Scanner", displayMode: .inline)
            .sheet(isPresented: $isShowingScanner) {
                CodeScannerView(
                    codeTypes: [.ean13, .ean8, .qr],
                    simulatedData: "1234567890",
                    completion: handleScan
                )
                .overlay(
                    ZStack {
                        RoundedRectangle(cornerRadius: 10)
                            .stroke(Color.accentColor, lineWidth: 2)
                            .frame(width: 250, height: 150)
                            .opacity(0.8)
                            .animation(Animation.easeInOut(duration: 1).repeatForever())

                        VStack {
                            Text("Align the barcode within the frame")
                                .font(.caption)
                                .foregroundColor(.white)
                                .padding(.top, 160)
                        }
                    }
                )
            }
        }
    }

    private func handleScan(result: Result<String, CodeScannerView.ScanError>) {
        isShowingScanner = false

        switch result {
        case .success(let code):
            withAnimation(.spring(response: 0.3, dampingFraction: 0.5, blendDuration: 0)) {
                scannedCode = code
            }
            UINotificationFeedbackGenerator().notificationOccurred(.success)
        case .failure:
            scannedCode = nil
        }
    }
}

@main
struct ScannerApp: App {
    var body: some Scene {
        WindowGroup {
            ScannerAppView()
        }
    }
}
